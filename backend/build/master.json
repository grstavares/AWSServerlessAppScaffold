{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Master Stack for Application",
  "Parameters": {
    "AppName": {
      "Type": "String",
      "Description": "The Name of the Application",
      "AllowedPattern": "(?!-)[a-zA-Z0-9-.]{1,63}(?<!-)",
      "ConstraintDescription": "must be a url compatible."
    },
    "BucketName": {
      "Type": "String",
      "Description": "The Name of the Bucket were templates and resources are located!",
      "AllowedPattern": "(?!-)[a-zA-Z0-9-.]{1,63}(?<!-)",
      "ConstraintDescription": "must be a url compatible."
    }
  },
  "Resources": {
    "AppApi": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TimeoutInMinutes": 60,
        "TemplateURL": {
          "Fn::Join": [
            "",
            [
              "https://s3.amazonaws.com/",
              {
                "Ref": "BucketName"
              },
              "/apidefinition.json"
            ]
          ]
        },
        "Parameters": {
          "AppName": {
            "Ref": "AppName"
          }
        }
      }
    },
    "MicroserviceEmpresa": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TimeoutInMinutes": 60,
        "TemplateURL": {
          "Fn::Join": [
            "",
            [
              "https://s3.amazonaws.com/",
              {
                "Ref": "BucketName"
              },
              "/",
              "empresa",
              ".json"
            ]
          ]
        },
        "Parameters": {
          "AppName": {
            "Ref": "AppName"
          },
          "FunctionBucket": {
            "Ref": "BucketName"
          },
          "FunctionKey": "empresa-0061e1e173f37cdf972078d2d0cd4d89.zip",
          "AppBaseUrl": "https://www.exemplo.com",
          "AppRestAPI": {
            "Fn::GetAtt": [
              "AppApi",
              "Outputs.AppRestAPIReference"
            ]
          },
          "AppRestAPIRootResource": {
            "Fn::GetAtt": [
              "AppApi",
              "Outputs.AppRestAPIRootResource"
            ]
          }
        }
      }
    },
    "MicroservicePessoa": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TimeoutInMinutes": 60,
        "TemplateURL": {
          "Fn::Join": [
            "",
            [
              "https://s3.amazonaws.com/",
              {
                "Ref": "BucketName"
              },
              "/",
              "pessoa",
              ".json"
            ]
          ]
        },
        "Parameters": {
          "AppName": {
            "Ref": "AppName"
          },
          "FunctionBucket": {
            "Ref": "BucketName"
          },
          "FunctionKey": "pessoa-7a78507a633b9ea9cac9a6ad4cb60ed5.zip",
          "AppBaseUrl": "https://www.exemplo.com",
          "AppRestAPI": {
            "Fn::GetAtt": [
              "AppApi",
              "Outputs.AppRestAPIReference"
            ]
          },
          "AppRestAPIRootResource": {
            "Fn::GetAtt": [
              "AppApi",
              "Outputs.AppRestAPIRootResource"
            ]
          }
        }
      }
    }
  },
  "Outputs": {
    "AppApi": {
      "Value": {
        "Fn::GetAtt": [
          "AppApi",
          "Outputs.AppRestAPIReference"
        ]
      },
      "Description": "Application RestAPI definition"
    },
    "AppApiRootResource": {
      "Value": {
        "Fn::GetAtt": [
          "AppApi",
          "Outputs.AppRestAPIRootResource"
        ]
      },
      "Description": "Application RestAPI definition"
    }
  }
}